<!DOCTYPE html>
<html lang="en">
<head><script>const TLP_SUPABASE_URL='https://gwjtfcrgpxclixonogpe.supabase.co';const TLP_SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3anRmY3JncHhjbGl4b25vZ3BlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMzQzOTUsImV4cCI6MjA4NTkxMDM5NX0.qM1-_VA1Dsx_nsWkeoAJvNWNgSuuwApPBGoJU32X3-I';const APP_NAME='contractor_timesheet';window.CloudSync={online:navigator.onLine,async save(k,d){localStorage.setItem(APP_NAME+'_'+k,JSON.stringify(d));if(!this.online)return{synced:false};try{const e=await fetch(TLP_SUPABASE_URL+'/rest/v1/app_data?app_data=eq.'+APP_NAME+'&data_key=eq.'+k+'&select=id',{headers:{apikey:TLP_SUPABASE_KEY,Authorization:'Bearer '+TLP_SUPABASE_KEY}}).then(r=>r.json());const m=e.length>0?'PATCH':'POST';const u=e.length>0?TLP_SUPABASE_URL+'/rest/v1/app_data?id=eq.'+e[0].id:TLP_SUPABASE_URL+'/rest/v1/app_data';await fetch(u,{method:m,headers:{apikey:TLP_SUPABASE_KEY,Authorization:'Bearer '+TLP_SUPABASE_KEY,'Content-Type':'application/json'},body:JSON.stringify(e.length>0?{data:d}:{app_data:APP_NAME,data_key:k,data:d})});return{synced:true};}catch(x){return{synced:false};}},async load(k){if(this.online){try{const r=await fetch(TLP_SUPABASE_URL+'/rest/v1/app_data?app_data=eq.'+APP_NAME+'&data_key=eq.'+k+'&select=data',{headers:{apikey:TLP_SUPABASE_KEY,Authorization:'Bearer '+TLP_SUPABASE_KEY}}).then(r=>r.json());if(r.length>0){localStorage.setItem(APP_NAME+'_'+k,JSON.stringify(r[0].data));return r[0].data;}}catch(x){}}const l=localStorage.getItem(APP_NAME+'_'+k);return l?JSON.parse(l):null;}};window.addEventListener('online',()=>CloudSync.online=true);window.addEventListener('offline',()=>CloudSync.online=false);</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contractor Timesheet - Abel Bustos</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0B0D14 0%, #141722 100%);
      color: #E2E8F0;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #06d6a0, #00b861);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .subtitle {
      text-align: center;
      color: #64748b;
      margin-bottom: 24px;
      font-size: 14px;
    }
    
    /* Week Selector */
    .week-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .week-btn {
      background: rgba(0, 232, 123, 0.2);
      border: 1px solid rgba(0, 232, 123, 0.4);
      color: #06d6a0;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
    }
    
    .week-btn:hover {
      background: rgba(0, 232, 123, 0.3);
    }
    
    .week-display {
      font-size: 16px;
      font-weight: 600;
      min-width: 200px;
      text-align: center;
    }
    
    /* Worker Cards */
    .worker-card {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .worker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .worker-name {
      font-size: 18px;
      font-weight: 700;
      color: #06d6a0;
    }
    
    .worker-rate {
      font-size: 14px;
      color: #64748b;
    }
    
    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 12px;
    }
    
    .day-col {
      text-align: center;
    }
    
    .day-label {
      font-size: 11px;
      color: #64748b;
      margin-bottom: 4px;
    }
    
    .day-input {
      width: 100%;
      padding: 8px 4px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 6px;
      color: #E2E8F0;
      text-align: center;
      font-size: 14px;
    }
    
    .day-input:focus {
      outline: none;
      border-color: #06d6a0;
    }
    
    .worker-totals {
      display: flex;
      justify-content: space-between;
      padding-top: 12px;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
      font-size: 14px;
    }
    
    .worker-total-hours {
      color: #94a3b8;
    }
    
    .worker-total-pay {
      color: #06d6a0;
      font-weight: 700;
    }
    
    /* Grand Total */
    .grand-total {
      background: rgba(0, 232, 123, 0.1);
      border: 2px solid rgba(0, 232, 123, 0.4);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin: 24px 0;
    }
    
    .grand-total-label {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .grand-total-amount {
      font-size: 32px;
      font-weight: 700;
      color: #06d6a0;
    }
    
    /* Buttons */
    .actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .btn {
      padding: 14px 24px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #06d6a0 0%, #00b861 100%);
      color: #000;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 232, 123, 0.4);
    }
    
    .btn-secondary {
      background: rgba(148, 163, 184, 0.2);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #E2E8F0;
    }
    
    .btn-secondary:hover {
      background: rgba(148, 163, 184, 0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Invoice Preview Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }
    
    .modal.active {
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }
    
    .invoice-preview {
      background: #fff;
      color: #000;
      max-width: 600px;
      width: 100%;
      padding: 40px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .invoice-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .invoice-title {
      font-size: 28px;
      font-weight: 700;
      color: #1a1a1a;
    }
    
    .invoice-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .invoice-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    .invoice-table th,
    .invoice-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    .invoice-table th {
      background: #f5f5f5;
      font-weight: 600;
    }
    
    .invoice-table td:last-child,
    .invoice-table th:last-child {
      text-align: right;
    }
    
    .invoice-total-row td {
      font-weight: 700;
      font-size: 16px;
      border-top: 2px solid #000;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      justify-content: center;
    }
    
    .modal-btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }
    
    .modal-btn-send {
      background: #00b861;
      color: #fff;
    }
    
    .modal-btn-close {
      background: #666;
      color: #fff;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 232, 123, 0.95);
      color: #000;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 2000;
    }
    
    .toast.visible {
      opacity: 1;
    }
    
    .toast.error {
      background: rgba(239, 68, 68, 0.95);
      color: #fff;
    }
    
    /* Notes */
    .notes-section {
      margin-top: 16px;
    }
    
    .notes-label {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .notes-input {
      width: 100%;
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 8px;
      color: #E2E8F0;
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
    }
    
    .notes-input:focus {
      outline: none;
      border-color: #06d6a0;
    }
    
    .save-indicator {
      text-align: center;
      font-size: 12px;
      color: #64748b;
      margin-top: 8px;
    }
    
    /* Mobile Responsive */
    @media (max-width: 480px) {
      body { padding: 12px; }
      h1 { font-size: 20px; }
      .week-selector { gap: 8px; }
      .week-btn { padding: 6px 12px; font-size: 16px; }
      .week-display { font-size: 14px; min-width: 160px; }
      .worker-card { padding: 12px; }
      .day-row { flex-direction: column; gap: 8px; }
      .day-row input { width: 100%; }
      .invoice-preview { padding: 20px; }
      .invoice-meta { flex-direction: column; gap: 12px; }
      .invoice-table th, .invoice-table td { padding: 8px; font-size: 13px; }
      .btn { padding: 12px 20px; font-size: 14px; }
    }
  </style>
  <script src="supabase-sync.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <a href="https://thelightparkops.com" style="position: absolute; top: 20px; left: 20px; color: #a855f7; text-decoration: none; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px; transition: all 0.2s; z-index: 1000;" onmouseover="this.style.color='#06d6a0'" onmouseout="this.style.color='#a855f7'">
    ‚Üê Dashboard
  </a>
  <div id="splash" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#0B0D14;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity 0.4s;">
    <div style="font-size:64px;margin-bottom:16px;">‚è∞</div>
    <div style="font-size:24px;font-weight:700;background:linear-gradient(135deg,#a855f7,#06d6a0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Contractor Timesheet</div>
    <div style="color:#8888a0;margin-top:8px;">Loading...</div>
  </div>
  <script>setTimeout(()=>{const s=document.getElementById("splash");if(s){s.style.opacity="0";setTimeout(()=>s.style.display="none",400);}},1500);</script>
  <div class="container" style="position: relative; padding-top: 50px;">
    <a href="https://thelightparkops.com" style="position: absolute; top: 20px; left: 20px; color: #a855f7; text-decoration: none; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px; transition: all 0.2s; z-index: 10;" onmouseover="this.style.color='#06d6a0'" onmouseout="this.style.color='#a855f7'">
      ‚Üê Dashboard
    </a>
    <h1>üìã Weekly Timesheet</h1>
    <p class="subtitle">Abel Bustos Crew ‚Ä¢ Light Bright LC</p>
    
    <div class="week-selector">
      <button class="week-btn" onclick="changeWeek(-1)">‚óÄ</button>
      <div class="week-display" id="weekDisplay"></div>
      <button class="week-btn" onclick="changeWeek(1)">‚ñ∂</button>
    </div>
    
    <div id="workerCards"></div>
    
    <div class="grand-total">
      <div class="grand-total-label">Invoice Total (Pay to Abel)</div>
      <div class="grand-total-amount" id="grandTotal">$0.00</div>
    </div>
    
    <div class="notes-section">
      <div class="notes-label">Notes (optional)</div>
      <textarea class="notes-input" id="notesInput" placeholder="Any notes for this week..." onchange="autoSave()"></textarea>
    </div>
    
    <div class="actions">
      <button class="btn btn-primary" onclick="previewInvoice()">üìÑ Preview Invoice</button>
      <button class="btn btn-secondary" onclick="saveData()">üíæ Save Progress</button>
    </div>
    <div class="save-indicator" id="saveIndicator"></div>
  </div>
  
  <div class="modal" id="invoiceModal">
    <div class="invoice-preview" id="invoiceContent"></div>
  </div>
  
  <div class="toast" id="toast"></div>

  <script>
    const WORKERS = [
      { id: 'abel', name: 'Abel Bustos', rate: 18 },
      { id: 'silvia', name: 'Silvia', rate: 16 },
      { id: 'citlaly', name: 'Citlaly', rate: 16 }
    ];
    
    const DAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    const ZAC_EMAIL = 'zthompson@amstadco.com';
    
    let currentWeekStart = getMonday(new Date());
    let timesheetData = {};
    
    // Get Monday of current week
    function getMonday(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - day + (day === 0 ? -6 : 1);
      d.setDate(diff);
      d.setHours(0, 0, 0, 0);
      return d;
    }
    
    // Format date range for display
    function formatWeekRange(monday) {
      const sunday = new Date(monday);
      sunday.setDate(sunday.getDate() + 6);
      const opts = { month: 'short', day: 'numeric' };
      return `${monday.toLocaleDateString('en-US', opts)} - ${sunday.toLocaleDateString('en-US', opts)}, ${monday.getFullYear()}`;
    }
    
    // Get week key for storage
    function getWeekKey(monday) {
      return monday.toISOString().split('T')[0];
    }
    
    // Change week
    function changeWeek(direction) {
      saveCurrentWeek();
      currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
      loadWeek();
    }
    
    // Load data from localStorage
    function loadData() {
      const saved = localStorage.getItem('abelCrewTimesheet');
      if (saved) {
        timesheetData = JSON.parse(saved);
      }
    }
    
    // Save data to localStorage
    function saveData() {
      saveCurrentWeek();
      localStorage.setItem('abelCrewTimesheet', JSON.stringify(timesheetData));
      showToast('‚úì Saved!');
      updateSaveIndicator();
    }
    
    // Auto-save after changes
    let autoSaveTimeout;
    function autoSave() {
      clearTimeout(autoSaveTimeout);
      autoSaveTimeout = setTimeout(() => {
        saveCurrentWeek();
        localStorage.setItem('abelCrewTimesheet', JSON.stringify(timesheetData));
        updateSaveIndicator();
      }, 1000);
    }
    
    function updateSaveIndicator() {
      const el = document.getElementById('saveIndicator');
      el.textContent = `Auto-saved ${new Date().toLocaleTimeString()}`;
    }
    
    // Save current week's hours
    function saveCurrentWeek() {
      const weekKey = getWeekKey(currentWeekStart);
      timesheetData[weekKey] = {
        hours: {},
        notes: document.getElementById('notesInput').value
      };
      
      WORKERS.forEach(worker => {
        timesheetData[weekKey].hours[worker.id] = [];
        DAYS.forEach((day, i) => {
          const input = document.getElementById(`hours-${worker.id}-${i}`);
          const value = parseFloat(input?.value) || 0;
          timesheetData[weekKey].hours[worker.id].push(value);
        });
      });
    }
    
    // Load current week's data
    function loadWeek() {
      document.getElementById('weekDisplay').textContent = formatWeekRange(currentWeekStart);
      
      const weekKey = getWeekKey(currentWeekStart);
      const weekData = timesheetData[weekKey] || { hours: {}, notes: '' };
      
      document.getElementById('notesInput').value = weekData.notes || '';
      
      WORKERS.forEach(worker => {
        const hours = weekData.hours?.[worker.id] || [0, 0, 0, 0, 0, 0, 0];
        DAYS.forEach((day, i) => {
          const input = document.getElementById(`hours-${worker.id}-${i}`);
          if (input) {
            input.value = hours[i] || '';
          }
        });
      });
      
      updateTotals();
    }
    
    // Render worker cards
    function renderWorkerCards() {
      const container = document.getElementById('workerCards');
      container.innerHTML = WORKERS.map(worker => `
        <div class="worker-card">
          <div class="worker-header">
            <div class="worker-name">${worker.name}</div>
            <div class="worker-rate">$${worker.rate}/hr</div>
          </div>
          <div class="days-grid">
            ${DAYS.map((day, i) => `
              <div class="day-col">
                <div class="day-label">${day}</div>
                <input type="number" 
                       class="day-input" 
                       id="hours-${worker.id}-${i}"
                       min="0" 
                       max="24" 
                       step="0.25"
                       placeholder="0"
                       inputmode="decimal"
                       onchange="updateTotals(); autoSave();">
              </div>
            `).join('')}
          </div>
          <div class="worker-totals">
            <div class="worker-total-hours" id="total-hours-${worker.id}">0 hrs</div>
            <div class="worker-total-pay" id="total-pay-${worker.id}">$0.00</div>
          </div>
        </div>
      `).join('');
    }
    
    // Update totals
    function updateTotals() {
      let grandTotal = 0;
      
      WORKERS.forEach(worker => {
        let totalHours = 0;
        DAYS.forEach((day, i) => {
          const input = document.getElementById(`hours-${worker.id}-${i}`);
          totalHours += parseFloat(input?.value) || 0;
        });
        
        const totalPay = totalHours * worker.rate;
        grandTotal += totalPay;
        
        document.getElementById(`total-hours-${worker.id}`).textContent = `${totalHours} hrs`;
        document.getElementById(`total-pay-${worker.id}`).textContent = `$${totalPay.toFixed(2)}`;
      });
      
      document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
    }
    
    // Preview invoice
    function previewInvoice() {
      saveCurrentWeek();
      
      const weekKey = getWeekKey(currentWeekStart);
      const weekData = timesheetData[weekKey] || { hours: {}, notes: '' };
      const weekRange = formatWeekRange(currentWeekStart);
      
      // Calculate invoice number from week
      const invoiceNum = Math.floor((currentWeekStart.getTime() - new Date('2025-01-01').getTime()) / (7 * 24 * 60 * 60 * 1000)) + 200;
      
      let subtotal = 0;
      const rows = WORKERS.map(worker => {
        const hours = (weekData.hours?.[worker.id] || []).reduce((a, b) => a + b, 0);
        const total = hours * worker.rate;
        subtotal += total;
        return { name: worker.name, hours, rate: worker.rate, total };
      }).filter(r => r.hours > 0);
      
      if (rows.length === 0) {
        showToast('No hours entered for this week', true);
        return;
      }
      
      const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      const dueDate = new Date();
      dueDate.setDate(dueDate.getDate() + 7);
      const dueDateStr = dueDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      const invoiceHTML = `
        <div class="invoice-header">
          <div class="invoice-title">INVOICE</div>
        </div>
        
        <div class="invoice-meta">
          <div>
            <strong>From:</strong><br>
            Abel Bustos<br>
            1301 Harvey Rd apt 291<br>
            College Station, TX 77840<br>
            956-258-7694
          </div>
          <div style="text-align: right;">
            <strong>Invoice #:</strong> ${invoiceNum}<br>
            <strong>Date:</strong> ${today}<br>
            <strong>Due:</strong> ${dueDateStr}
          </div>
        </div>
        
        <div class="invoice-meta">
          <div>
            <strong>Bill To:</strong><br>
            Light Bright LC<br>
            4501 Mills Park Circle<br>
            College Station, TX 77845
          </div>
          <div style="text-align: right;">
            <strong>Project:</strong><br>
            Warehouse work<br>
            <strong>Week:</strong><br>
            ${weekRange}
          </div>
        </div>
        
        <table class="invoice-table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Hours</th>
              <th>Rate</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td>${r.name}</td>
                <td>${r.hours}</td>
                <td>$${r.rate.toFixed(2)}</td>
                <td>$${r.total.toFixed(2)}</td>
              </tr>
            `).join('')}
            <tr class="invoice-total-row">
              <td colspan="3">TOTAL (Payable to Abel Bustos)</td>
              <td>$${subtotal.toFixed(2)}</td>
            </tr>
          </tbody>
        </table>
        
        ${weekData.notes ? `<p><strong>Notes:</strong> ${weekData.notes}</p>` : ''}
        
        <div class="modal-actions">
          <button class="modal-btn modal-btn-send" onclick="sendInvoice()">üìß Send to Amstad</button>
          <button class="modal-btn" style="background:#2563eb;color:#fff;" onclick="downloadPDF()">üì• Download PDF</button>
          <button class="modal-btn modal-btn-close" onclick="closeModal()">Close</button>
        </div>
      `;
      
      document.getElementById('invoiceContent').innerHTML = invoiceHTML;
      document.getElementById('invoiceModal').classList.add('active');
    }
    
    // Close modal
    function closeModal() {
      document.getElementById('invoiceModal').classList.remove('active');
    }
    
    // Generate PDF invoice
    function generatePDF() {
      saveCurrentWeek();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const weekKey = getWeekKey(currentWeekStart);
      const weekData = timesheetData[weekKey] || { hours: {}, notes: '' };
      const weekRange = formatWeekRange(currentWeekStart);
      const invoiceNum = Math.floor((currentWeekStart.getTime() - new Date('2025-01-01').getTime()) / (7 * 24 * 60 * 60 * 1000)) + 200;
      const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      const dueDate = new Date();
      dueDate.setDate(dueDate.getDate() + 7);
      const dueDateStr = dueDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      // Dark header bar
      doc.setFillColor(26, 26, 26);
      doc.rect(0, 0, 210, 40, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(28);
      doc.setFont('helvetica', 'bold');
      doc.text('INVOICE', 20, 27);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'normal');
      doc.text('Light Bright LC', 150, 20);
      doc.text('Contractor Services', 150, 27);
      
      // Reset text color
      doc.setTextColor(0, 0, 0);
      let y = 55;
      
      // From / Invoice info side by side
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text('From:', 20, y);
      doc.setFont('helvetica', 'normal');
      doc.text('Abel Bustos', 20, y + 6);
      doc.text('1301 Harvey Rd apt 291', 20, y + 12);
      doc.text('College Station, TX 77840', 20, y + 18);
      doc.text('956-258-7694', 20, y + 24);
      
      doc.setFont('helvetica', 'bold');
      doc.text('Invoice #:', 140, y);
      doc.setFont('helvetica', 'normal');
      doc.text(String(invoiceNum), 170, y);
      doc.setFont('helvetica', 'bold');
      doc.text('Date:', 140, y + 8);
      doc.setFont('helvetica', 'normal');
      doc.text(today, 155, y + 8);
      doc.setFont('helvetica', 'bold');
      doc.text('Due:', 140, y + 16);
      doc.setFont('helvetica', 'normal');
      doc.text(dueDateStr, 153, y + 16);
      
      y += 38;
      
      // Bill To
      doc.setFont('helvetica', 'bold');
      doc.text('Bill To:', 20, y);
      doc.setFont('helvetica', 'normal');
      doc.text('Light Bright LC', 20, y + 6);
      doc.text('4501 Mills Park Circle', 20, y + 12);
      doc.text('College Station, TX 77845', 20, y + 18);
      
      // Project / Week
      doc.setFont('helvetica', 'bold');
      doc.text('Project:', 140, y);
      doc.setFont('helvetica', 'normal');
      doc.text('Warehouse work', 140, y + 6);
      doc.setFont('helvetica', 'bold');
      doc.text('Week:', 140, y + 14);
      doc.setFont('helvetica', 'normal');
      doc.text(weekRange, 140, y + 20);
      
      y += 32;
      
      // Table data
      let subtotal = 0;
      const tableRows = WORKERS.map(worker => {
        const hours = (weekData.hours?.[worker.id] || []).reduce((a, b) => a + b, 0);
        const total = hours * worker.rate;
        subtotal += total;
        return hours > 0 ? [worker.name, String(hours), '$' + worker.rate.toFixed(2), '$' + total.toFixed(2)] : null;
      }).filter(Boolean);
      
      doc.autoTable({
        startY: y,
        head: [['Description', 'Hours', 'Rate', 'Amount']],
        body: tableRows,
        foot: [['TOTAL (Payable to Abel Bustos)', '', '', '$' + subtotal.toFixed(2)]],
        theme: 'grid',
        headStyles: { fillColor: [30, 30, 30], textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 11 },
        footStyles: { fillColor: [240, 240, 240], textColor: [0, 0, 0], fontStyle: 'bold', fontSize: 12 },
        styles: { fontSize: 10, cellPadding: 6 },
        columnStyles: {
          0: { cellWidth: 80 },
          1: { halign: 'center' },
          2: { halign: 'right' },
          3: { halign: 'right' }
        },
        margin: { left: 20, right: 20 }
      });
      
      // Notes
      if (weekData.notes) {
        const finalY = doc.lastAutoTable.finalY + 15;
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(10);
        doc.text('Notes:', 20, finalY);
        doc.setFont('helvetica', 'normal');
        doc.text(weekData.notes, 20, finalY + 7, { maxWidth: 170 });
      }
      
      return { doc, weekRange, subtotal };
    }
    
    // Download PDF only
    function downloadPDF() {
      const result = generatePDF();
      if (!result) return;
      const filename = 'Invoice-AbelBustos-' + result.weekRange.replace(/[^a-zA-Z0-9-]/g, '') + '.pdf';
      result.doc.save(filename);
      showToast('üìÑ Invoice PDF downloaded!');
    }
    
    // Send invoice via email with PDF
    function sendInvoice() {
      const result = generatePDF();
      if (!result) return;
      const weekRange = result.weekRange;
      const filename = 'Invoice-AbelBustos-' + weekRange.replace(/[^a-zA-Z0-9-]/g, '') + '.pdf';
      
      // Download the PDF
      result.doc.save(filename);
      
      // Open mailto
      const subject = encodeURIComponent(`Invoice - Abel Bustos Crew - ${weekRange}`);
      const body = encodeURIComponent(
        `Hi Zac,\n\n` +
        `Please find attached the PDF invoice for the week of ${weekRange}.\n\n` +
        `Filename: ${filename}\n` +
        `Total Due: $${result.subtotal.toFixed(2)}\n` +
        `Payable to: Abel Bustos\n\n` +
        `Please don't forget to attach the downloaded PDF to this email.\n\n` +
        `Thank you!`
      );
      
      window.open(`mailto:${ZAC_EMAIL}?subject=${subject}&body=${body}`, '_blank');
      closeModal();
      showToast('üìÑ Invoice PDF downloaded! Attach it to the email.');
    }
    
    // Show toast
    function showToast(message, isError = false) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.toggle('error', isError);
      toast.classList.add('visible');
      setTimeout(() => toast.classList.remove('visible'), 3000);
    }
    
    // Click outside modal to close
    document.getElementById('invoiceModal').addEventListener('click', (e) => {
      if (e.target.id === 'invoiceModal') closeModal();
    });
    
    // Initialize
    loadData();
    renderWorkerCards();
    loadWeek();
  </script>
</body>
</html>
