<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contractor Timesheet</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0B0D14 0%, #141722 100%);
      color: #E2E8F0;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #00e87b, #00b861);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .subtitle {
      text-align: center;
      color: #64748b;
      margin-bottom: 24px;
      font-size: 14px;
    }
    
    /* Week Selector */
    .week-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .week-btn {
      background: rgba(0, 232, 123, 0.2);
      border: 1px solid rgba(0, 232, 123, 0.4);
      color: #00e87b;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
    }
    
    .week-btn:hover {
      background: rgba(0, 232, 123, 0.3);
    }
    
    .week-display {
      font-size: 16px;
      font-weight: 600;
      min-width: 200px;
      text-align: center;
    }
    
    /* Worker Cards */
    .worker-card {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .worker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .worker-name {
      font-size: 18px;
      font-weight: 700;
      color: #00e87b;
    }
    
    .worker-rate {
      font-size: 14px;
      color: #64748b;
    }
    
    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 12px;
    }
    
    .day-col {
      text-align: center;
    }
    
    .day-label {
      font-size: 11px;
      color: #64748b;
      margin-bottom: 4px;
    }
    
    .day-input {
      width: 100%;
      padding: 8px 4px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 6px;
      color: #E2E8F0;
      text-align: center;
      font-size: 14px;
    }
    
    .day-input:focus {
      outline: none;
      border-color: #00e87b;
    }
    
    .worker-totals {
      display: flex;
      justify-content: space-between;
      padding-top: 12px;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
      font-size: 14px;
    }
    
    .worker-total-hours {
      color: #94a3b8;
    }
    
    .worker-total-pay {
      color: #00e87b;
      font-weight: 700;
    }
    
    /* Grand Total */
    .grand-total {
      background: rgba(0, 232, 123, 0.1);
      border: 2px solid rgba(0, 232, 123, 0.4);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin: 24px 0;
    }
    
    .grand-total-label {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .grand-total-amount {
      font-size: 32px;
      font-weight: 700;
      color: #00e87b;
    }
    
    /* Buttons */
    .actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .btn {
      padding: 14px 24px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #00e87b 0%, #00b861 100%);
      color: #000;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 232, 123, 0.4);
    }
    
    .btn-secondary {
      background: rgba(148, 163, 184, 0.2);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #E2E8F0;
    }
    
    .btn-secondary:hover {
      background: rgba(148, 163, 184, 0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Invoice Preview Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }
    
    .modal.active {
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }
    
    .invoice-preview {
      background: #fff;
      color: #000;
      max-width: 600px;
      width: 100%;
      padding: 40px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .invoice-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .invoice-title {
      font-size: 28px;
      font-weight: 700;
      color: #1a1a1a;
    }
    
    .invoice-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .invoice-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    .invoice-table th,
    .invoice-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    .invoice-table th {
      background: #f5f5f5;
      font-weight: 600;
    }
    
    .invoice-table td:last-child,
    .invoice-table th:last-child {
      text-align: right;
    }
    
    .invoice-total-row td {
      font-weight: 700;
      font-size: 16px;
      border-top: 2px solid #000;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      justify-content: center;
    }
    
    .modal-btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }
    
    .modal-btn-send {
      background: #00b861;
      color: #fff;
    }
    
    .modal-btn-close {
      background: #666;
      color: #fff;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 232, 123, 0.95);
      color: #000;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 2000;
    }
    
    .toast.visible {
      opacity: 1;
    }
    
    .toast.error {
      background: rgba(239, 68, 68, 0.95);
      color: #fff;
    }
    
    /* Notes */
    .notes-section {
      margin-top: 16px;
    }
    
    .notes-label {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .notes-input {
      width: 100%;
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 8px;
      color: #E2E8F0;
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
    }
    
    .notes-input:focus {
      outline: none;
      border-color: #00e87b;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“‹ Contractor Timesheet</h1>
    <p class="subtitle" id="workerSubtitle">Light Bright LC - Weekly Hours</p>
    
    <div class="week-selector">
      <button class="week-btn" onclick="changeWeek(-1)">â—€</button>
      <div class="week-display" id="weekDisplay"></div>
      <button class="week-btn" onclick="changeWeek(1)">â–¶</button>
    </div>
    
    <div id="workerCards"></div>
    
    <div class="grand-total">
      <div class="grand-total-label">Week Total</div>
      <div class="grand-total-amount" id="grandTotal">$0.00</div>
    </div>
    
    <div class="notes-section">
      <div class="notes-label">Notes (optional)</div>
      <textarea class="notes-input" id="notesInput" placeholder="Any notes for this week..."></textarea>
    </div>
    
    <div class="actions">
      <button class="btn btn-primary" onclick="previewInvoice()">ðŸ“„ Preview Invoice</button>
      <button class="btn btn-secondary" onclick="saveData()">ðŸ’¾ Save Progress</button>
    </div>
  </div>
  
  <div class="modal" id="invoiceModal">
    <div class="invoice-preview" id="invoiceContent"></div>
  </div>
  
  <div class="toast" id="toast"></div>

  <script>
    const ALL_WORKERS = {
      'abel': { name: 'Abel Bustos', rate: 18 },
      'silvia': { name: 'Silvia', rate: 16 },
      'citlay': { name: 'Citlay', rate: 16 }
    };
    
    const DAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    const BOB_EMAIL = 'bobdodgecreative@gmail.com';
    
    // Get worker from URL param
    const urlParams = new URLSearchParams(window.location.search);
    const workerId = urlParams.get('worker')?.toLowerCase();
    const CURRENT_WORKER = ALL_WORKERS[workerId];
    
    // If no valid worker, show picker
    if (!CURRENT_WORKER) {
      document.body.innerHTML = `
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;gap:20px;padding:20px;">
          <h1 style="color:#00e87b;font-size:24px;">ðŸ“‹ Contractor Timesheet</h1>
          <p style="color:#64748b;">Select your name:</p>
          <a href="?worker=abel" style="display:block;padding:16px 40px;background:linear-gradient(135deg,#00e87b,#00b861);color:#000;text-decoration:none;border-radius:10px;font-weight:700;font-size:18px;">Abel Bustos</a>
          <a href="?worker=silvia" style="display:block;padding:16px 40px;background:linear-gradient(135deg,#00e87b,#00b861);color:#000;text-decoration:none;border-radius:10px;font-weight:700;font-size:18px;">Silvia</a>
          <a href="?worker=citlay" style="display:block;padding:16px 40px;background:linear-gradient(135deg,#00e87b,#00b861);color:#000;text-decoration:none;border-radius:10px;font-weight:700;font-size:18px;">Citlay</a>
        </div>
      `;
      throw new Error('No worker selected');
    }
    
    let currentWeekStart = getMonday(new Date());
    let timesheetData = {};
    
    // Get Monday of current week
    function getMonday(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - day + (day === 0 ? -6 : 1);
      d.setDate(diff);
      d.setHours(0, 0, 0, 0);
      return d;
    }
    
    // Format date range for display
    function formatWeekRange(monday) {
      const sunday = new Date(monday);
      sunday.setDate(sunday.getDate() + 6);
      const opts = { month: 'short', day: 'numeric' };
      return `${monday.toLocaleDateString('en-US', opts)} - ${sunday.toLocaleDateString('en-US', opts)}, ${monday.getFullYear()}`;
    }
    
    // Get week key for storage
    function getWeekKey(monday) {
      return monday.toISOString().split('T')[0];
    }
    
    // Change week
    function changeWeek(direction) {
      saveCurrentWeek();
      currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
      loadWeek();
    }
    
    // Load data from localStorage (worker-specific)
    function loadData() {
      const storageKey = `timesheet_${workerId}`;
      const saved = localStorage.getItem(storageKey);
      if (saved) {
        timesheetData = JSON.parse(saved);
      }
    }
    
    // Save data to localStorage (worker-specific)
    function saveData() {
      saveCurrentWeek();
      const storageKey = `timesheet_${workerId}`;
      localStorage.setItem(storageKey, JSON.stringify(timesheetData));
      showToast('âœ“ Saved!');
    }
    
    // Save current week's hours
    function saveCurrentWeek() {
      const weekKey = getWeekKey(currentWeekStart);
      timesheetData[weekKey] = {
        hours: [],
        notes: document.getElementById('notesInput').value
      };
      
      DAYS.forEach((day, i) => {
        const input = document.getElementById(`hours-${i}`);
        const value = parseFloat(input?.value) || 0;
        timesheetData[weekKey].hours.push(value);
      });
    }
    
    // Load current week's data
    function loadWeek() {
      document.getElementById('weekDisplay').textContent = formatWeekRange(currentWeekStart);
      
      const weekKey = getWeekKey(currentWeekStart);
      const weekData = timesheetData[weekKey] || { hours: [], notes: '' };
      
      document.getElementById('notesInput').value = weekData.notes || '';
      
      const hours = weekData.hours || [0, 0, 0, 0, 0, 0, 0];
      DAYS.forEach((day, i) => {
        const input = document.getElementById(`hours-${i}`);
        if (input) {
          input.value = hours[i] || '';
        }
      });
      
      updateTotals();
    }
    
    // Auto-save on change
    let autoSaveTimeout;
    function autoSave() {
      clearTimeout(autoSaveTimeout);
      autoSaveTimeout = setTimeout(() => {
        saveData();
      }, 1000);
    }
    
    // Render worker card (single worker)
    function renderWorkerCards() {
      // Update subtitle with worker name
      document.getElementById('workerSubtitle').textContent = `${CURRENT_WORKER.name} â€¢ $${CURRENT_WORKER.rate}/hr`;
      
      const container = document.getElementById('workerCards');
      container.innerHTML = `
        <div class="worker-card">
          <div class="worker-header">
            <div class="worker-name">Weekly Hours</div>
            <div class="worker-rate">Enter your hours each day</div>
          </div>
          <div class="days-grid">
            ${DAYS.map((day, i) => `
              <div class="day-col">
                <div class="day-label">${day}</div>
                <input type="number" 
                       class="day-input" 
                       id="hours-${i}"
                       min="0" 
                       max="24" 
                       step="0.25"
                       placeholder="0"
                       onchange="updateTotals(); autoSave();">
              </div>
            `).join('')}
          </div>
          <div class="worker-totals">
            <div class="worker-total-hours" id="total-hours">0 hrs</div>
            <div class="worker-total-pay" id="total-pay">$0.00</div>
          </div>
        </div>
      `;
    }
    
    // Update totals
    function updateTotals() {
      let totalHours = 0;
      DAYS.forEach((day, i) => {
        const input = document.getElementById(`hours-${i}`);
        totalHours += parseFloat(input?.value) || 0;
      });
      
      const totalPay = totalHours * CURRENT_WORKER.rate;
      
      document.getElementById('total-hours').textContent = `${totalHours} hrs`;
      document.getElementById('total-pay').textContent = `$${totalPay.toFixed(2)}`;
      document.getElementById('grandTotal').textContent = `$${totalPay.toFixed(2)}`;
    }
    
    // Preview invoice
    function previewInvoice() {
      saveCurrentWeek();
      
      const weekKey = getWeekKey(currentWeekStart);
      const weekData = timesheetData[weekKey] || { hours: [], notes: '' };
      const weekRange = formatWeekRange(currentWeekStart);
      
      // Calculate invoice number from week + worker
      const weekNum = Math.floor((currentWeekStart.getTime() - new Date('2025-01-01').getTime()) / (7 * 24 * 60 * 60 * 1000));
      const invoiceNum = `${weekNum}-${workerId.toUpperCase().slice(0,3)}`;
      
      const totalHours = (weekData.hours || []).reduce((a, b) => a + b, 0);
      const totalPay = totalHours * CURRENT_WORKER.rate;
      
      if (totalHours === 0) {
        showToast('No hours entered for this week', true);
        return;
      }
      
      const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      const dueDate = new Date();
      dueDate.setDate(dueDate.getDate() + 7);
      const dueDateStr = dueDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      const invoiceHTML = `
        <div class="invoice-header">
          <div class="invoice-title">TIMESHEET</div>
        </div>
        
        <div class="invoice-meta">
          <div>
            <strong>From:</strong><br>
            ${CURRENT_WORKER.name}
          </div>
          <div style="text-align: right;">
            <strong>Week:</strong> ${weekRange}<br>
            <strong>Date:</strong> ${today}
          </div>
        </div>
        
        <div class="invoice-meta">
          <div>
            <strong>To:</strong><br>
            Light Bright LC<br>
            College Station, TX
          </div>
          <div style="text-align: right;">
            <strong>Project:</strong><br>
            Warehouse work
          </div>
        </div>
        
        <table class="invoice-table">
          <thead>
            <tr>
              <th>Day</th>
              <th>Hours</th>
            </tr>
          </thead>
          <tbody>
            ${DAYS.map((day, i) => {
              const hrs = weekData.hours?.[i] || 0;
              return hrs > 0 ? `<tr><td>${day}</td><td>${hrs}</td></tr>` : '';
            }).join('')}
            <tr class="invoice-total-row">
              <td><strong>Total Hours</strong></td>
              <td><strong>${totalHours}</strong></td>
            </tr>
          </tbody>
        </table>
        
        <div style="margin-top:20px;padding:16px;background:#f5f5f5;border-radius:8px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
            <span>Rate:</span>
            <span>$${CURRENT_WORKER.rate.toFixed(2)}/hr</span>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:20px;font-weight:700;">
            <span>Amount Due:</span>
            <span>$${totalPay.toFixed(2)}</span>
          </div>
        </div>
        
        ${weekData.notes ? `<p style="margin-top:16px;"><strong>Notes:</strong> ${weekData.notes}</p>` : ''}
        
        <div class="modal-actions">
          <button class="modal-btn modal-btn-send" onclick="sendInvoice()">ðŸ“§ Send to Bob</button>
          <button class="modal-btn modal-btn-close" onclick="closeModal()">Close</button>
        </div>
      `;
      
      document.getElementById('invoiceContent').innerHTML = invoiceHTML;
      document.getElementById('invoiceModal').classList.add('active');
    }
    
    // Close modal
    function closeModal() {
      document.getElementById('invoiceModal').classList.remove('active');
    }
    
    // Send invoice via email
    function sendInvoice() {
      saveCurrentWeek();
      
      const weekKey = getWeekKey(currentWeekStart);
      const weekData = timesheetData[weekKey] || { hours: [], notes: '' };
      const weekRange = formatWeekRange(currentWeekStart);
      
      const totalHours = (weekData.hours || []).reduce((a, b) => a + b, 0);
      const totalPay = totalHours * CURRENT_WORKER.rate;
      
      // Build daily breakdown
      const dailyLines = DAYS.map((day, i) => {
        const hrs = weekData.hours?.[i] || 0;
        return hrs > 0 ? `  ${day}: ${hrs} hrs` : null;
      }).filter(Boolean).join('\n');
      
      const subject = encodeURIComponent(`Timesheet - ${CURRENT_WORKER.name} - ${weekRange}`);
      const body = encodeURIComponent(
        `TIMESHEET\n` +
        `=========\n\n` +
        `Worker: ${CURRENT_WORKER.name}\n` +
        `Week: ${weekRange}\n` +
        `Rate: $${CURRENT_WORKER.rate}/hr\n\n` +
        `HOURS:\n${dailyLines}\n\n` +
        `Total Hours: ${totalHours}\n` +
        `AMOUNT DUE: $${totalPay.toFixed(2)}\n` +
        (weekData.notes ? `\nNotes: ${weekData.notes}` : '')
      );
      
      window.open(`mailto:${BOB_EMAIL}?subject=${subject}&body=${body}`, '_blank');
      closeModal();
      showToast('ðŸ“§ Opening email...');
    }
    
    // Show toast
    function showToast(message, isError = false) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.toggle('error', isError);
      toast.classList.add('visible');
      setTimeout(() => toast.classList.remove('visible'), 3000);
    }
    
    // Click outside modal to close
    document.getElementById('invoiceModal').addEventListener('click', (e) => {
      if (e.target.id === 'invoiceModal') closeModal();
    });
    
    // Initialize
    loadData();
    renderWorkerCards();
    loadWeek();
  </script>
</body>
</html>
